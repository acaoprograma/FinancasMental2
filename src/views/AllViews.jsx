import React, { useState, useMemo } from 'react';
import { jsPDF } from 'jspdf';
import 'jspdf-autotable';
import Papa from 'papaparse';
import { Icon, Card, StatCard, Button, Input, Select, PrivacyMask, useToast } from '../components/UI';
import { formatCurrency } from '../utils/currency';

// --- ARQUIVO DE VIEWS SECUND츼RIAS ---
// (Dashboard, Login e Finan칞as j치 foram movidos para arquivos pr칩prios!)

export const ShoppingView = ({ items, onAdd, onCheck, onLaunch, openModal }) => { const total = items.reduce((acc, i) => acc + (parseFloat(i.price) * parseFloat(i.quantity)), 0); const checkedTotal = items.filter(i => i.checked).reduce((acc, i) => acc + (parseFloat(i.price) * parseFloat(i.quantity)), 0); return (<div className="animate-fade-in pb-24"><div className="flex justify-between items-center mb-8"><h2 className="text-2xl font-black flex items-center gap-2 text-slate-800 dark:text-white"><Icon name="cart" className="text-brand-600"/> Lista de Compras</h2><Button onClick={() => openModal('newShopItem')} icon="plus">Adicionar Item</Button></div><div className="grid grid-cols-1 lg:grid-cols-3 gap-8"><div className="lg:col-span-2 space-y-3">{items.map(item => (<Card key={item.id} className={`flex items-center justify-between !p-4 transition-all ${item.checked ? 'opacity-50 bg-slate-100 dark:bg-slate-800/50' : ''}`}><div className="flex items-center gap-4"><button onClick={() => onCheck(item.id, !item.checked)} className={`w-6 h-6 rounded-lg border-2 flex items-center justify-center transition-colors ${item.checked ? 'bg-emerald-500 border-emerald-500 text-white' : 'border-slate-300 dark:border-slate-600'}`}>{item.checked && <Icon name="check" size={14}/>}</button><div><h3 className={`font-bold text-lg ${item.checked ? 'line-through text-slate-400' : 'text-slate-800 dark:text-white'}`}>{item.name}</h3><p className="text-xs text-slate-500">{item.quantity}x {formatCurrency(parseFloat(item.price))}</p></div></div><p className="font-bold text-lg text-slate-700 dark:text-white">{formatCurrency(parseFloat(item.price) * parseFloat(item.quantity))}</p></Card>))}</div><div className="lg:col-span-1"><Card className="sticky top-6 bg-brand-50 dark:bg-slate-800/50 border-brand-200 dark:border-brand-900"><h3 className="font-bold text-xl mb-6 text-slate-800 dark:text-white">Resumo</h3><div className="space-y-3 mb-6"><div className="flex justify-between text-sm text-slate-500"><span>Total da Lista</span><span className="font-bold">{formatCurrency(total)}</span></div><div className="flex justify-between text-lg font-black text-brand-600"><span>Carrinho (Marcados)</span><span>{formatCurrency(checkedTotal)}</span></div></div><Button onClick={() => onLaunch(checkedTotal)} className="w-full" disabled={checkedTotal === 0} icon="check">Lan칞ar Despesa</Button><p className="text-xs text-center text-slate-400 mt-3">Cria uma despesa com o total dos itens marcados.</p></Card></div></div></div>); };
export const SubscriptionsView = ({ subscriptions, onAdd, onDelete, privacy, openModal }) => { const totalMonthly = subscriptions.reduce((acc, s) => acc + (s.billingCycle === 'monthly' ? parseFloat(s.price) : parseFloat(s.price)/12), 0); const totalYearly = totalMonthly * 12; return (<div className="animate-fade-in pb-24"><div className="flex justify-between items-center mb-8"><h2 className="text-2xl font-black flex items-center gap-2 text-slate-800 dark:text-white"><Icon name="tv" className="text-brand-600"/> Assinaturas</h2><Button onClick={() => openModal('newSub')} icon="plus">Nova Assinatura</Button></div><div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"><Card className="bg-gradient-to-br from-brand-500 to-purple-600 text-white border-none"><p className="text-indigo-100 font-bold text-xs uppercase tracking-wider">Custo Mensal Estimado</p><p className="text-4xl font-black mt-1"><PrivacyMask value={formatCurrency(totalMonthly)} privacyMode={privacy}/></p></Card><Card className="bg-white dark:bg-slate-800"><p className="text-slate-400 font-bold text-xs uppercase tracking-wider">Custo Anual (Proje칞칚o)</p><p className="text-3xl font-black mt-1 text-slate-800 dark:text-white"><PrivacyMask value={formatCurrency(totalYearly)} privacyMode={privacy}/></p></Card></div><div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">{subscriptions.map(s => (<Card key={s.id} className="flex items-center justify-between"><div className="flex items-center gap-4"><div className="w-12 h-12 rounded-2xl bg-slate-100 dark:bg-slate-700 flex items-center justify-center text-slate-500"><Icon name={s.category === 'Streaming' ? 'tv' : s.category === 'M칰sica' ? 'music' : 'repeat'} /></div><div><h3 className="font-bold text-slate-800 dark:text-white">{s.name}</h3><p className="text-xs text-slate-400 font-medium uppercase">{s.billingCycle === 'monthly' ? 'Mensal' : 'Anual'}</p></div></div><div className="text-right"><p className="font-black text-slate-700 dark:text-white"><PrivacyMask value={formatCurrency(parseFloat(s.price), s.currency || 'BRL')} privacyMode={privacy}/></p><button onClick={() => confirm('Cancelar assinatura?') && onDelete(s.id)} className="text-xs text-rose-500 hover:underline font-bold mt-1">Cancelar</button></div></Card>))}</div></div>); };
export const GamificationView = ({ transactions, investments, goals, recurring, mentalLogs, privacy }) => { const stats = { saved: transactions.reduce((acc, t) => acc + (t.type==='income' ? parseFloat(t.amount) : -parseFloat(t.amount)), 0), invested: investments.length, goals: goals.length, recurring: recurring.length, mental: mentalLogs.length }; const badges = [ { id: 1, name: 'Primeiros Passos', desc: 'Crie sua conta e fa칞a um lan칞amento', unlocked: transactions.length > 0, icon: 'star', color: 'text-yellow-500' }, { id: 2, name: 'Poupador Zen', desc: 'Tenha saldo positivo', unlocked: stats.saved > 0, icon: 'wallet', color: 'text-emerald-500' }, { id: 3, name: 'Investidor', desc: 'Adicione 1 investimento', unlocked: stats.invested > 0, icon: 'trending', color: 'text-brand-500' }, { id: 4, name: 'Vision치rio', desc: 'Crie uma meta', unlocked: stats.goals > 0, icon: 'target', color: 'text-purple-500' }, { id: 5, name: 'Organizado', desc: 'Cadastre 3 contas fixas', unlocked: stats.recurring >= 3, icon: 'list', color: 'text-blue-500' }, { id: 6, name: 'Mente S칚', desc: 'Fa칞a 5 check-ins mentais', unlocked: stats.mental >= 5, icon: 'brain', color: 'text-rose-500' }, ]; return (<div className="animate-fade-in pb-24"><div className="flex justify-between items-center mb-8"><h2 className="text-2xl font-black flex items-center gap-2 text-slate-800 dark:text-white"><Icon name="award" className="text-brand-600"/> Conquistas</h2></div><div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">{badges.map(b => (<Card key={b.id} className={`relative overflow-hidden ${!b.unlocked ? 'opacity-50 grayscale' : ''}`}><div className="flex items-start gap-4 relative z-10"><div className={`w-16 h-16 rounded-2xl bg-slate-100 dark:bg-slate-900 flex items-center justify-center shadow-inner ${b.color}`}><Icon name={b.icon} size={32}/></div><div><h3 className="font-bold text-lg text-slate-800 dark:text-white">{b.name}</h3><p className="text-sm text-slate-500 leading-tight">{b.desc}</p>{b.unlocked && <span className="inline-block mt-2 text-[10px] font-bold uppercase tracking-wider bg-emerald-100 text-emerald-600 px-2 py-1 rounded">Desbloqueado</span>}</div></div></Card>))}</div></div>); };
export const SettingsView = ({ categories, rates, onUpdateRates, onAddCat, onImport, onExport, openModal }) => (<div className="animate-fade-in pb-24 grid lg:grid-cols-2 gap-8"><div className="space-y-8"><div><h2 className="text-xl font-black mb-6 text-slate-800 dark:text-white flex items-center gap-2"><Icon name="settings"/> Dados</h2><Card className="space-y-4"><h3 className="font-bold text-lg">Backup Seguro</h3><div className="grid grid-cols-2 gap-4"><Button onClick={onExport} variant="secondary" icon="save">Salvar</Button><label className="cursor-pointer bg-brand-600 text-white px-6 py-3 rounded-2xl font-bold flex items-center justify-center gap-2 hover:bg-brand-700 transition-all"><Icon name="upload" size={18}/> Restaurar<input type="file" className="hidden" onChange={onImport} accept=".json"/></label></div></Card></div><div><h2 className="text-xl font-black mb-6 text-slate-800 dark:text-white flex items-center gap-2"><Icon name="globe"/> Cota칞칚o</h2><Card className="space-y-4"><p className="text-xs text-slate-400">C칙mbio para convers칚o no Dashboard.</p><div className="grid grid-cols-3 gap-4"><Input label="USD" type="number" step="0.01" value={rates.USD} onChange={e => onUpdateRates('USD', e.target.value)} /><Input label="EUR" type="number" step="0.01" value={rates.EUR} onChange={e => onUpdateRates('EUR', e.target.value)} /><Input label="GBP" type="number" step="0.01" value={rates.GBP} onChange={e => onUpdateRates('GBP', e.target.value)} /></div></Card></div></div><div><div className="flex justify-between items-center mb-6"><h2 className="text-xl font-black text-slate-800 dark:text-white">Categorias</h2><Button onClick={() => openModal('newCategory')} variant="ghost" className="text-sm px-3">+ Adicionar</Button></div><div className="grid grid-cols-2 gap-3">{categories.map(c=><div key={c.id} className="bg-white dark:bg-slate-800 p-3 rounded-xl border border-slate-100 dark:border-slate-700 shadow-sm flex items-center gap-2 text-sm font-bold text-slate-600 dark:text-slate-300"><div className="w-8 h-8 bg-slate-100 dark:bg-slate-700 rounded-lg flex items-center justify-center">{c.name[0]}</div>{c.name}</div>)}</div></div></div>);
export const GoalsView = ({ goals, onAdd, onUpdate, privacy, openModal }) => (<div className="animate-fade-in pb-24"><div className="flex justify-between items-center mb-8"><h2 className="text-2xl font-black flex items-center gap-2 text-slate-800 dark:text-white"><Icon name="target" className="text-brand-500"/> Metas</h2><Button onClick={() => openModal('newGoal')} icon="plus">Nova Meta</Button></div><div className="grid grid-cols-1 md:grid-cols-3 gap-6">{goals.map(g => { const p = Math.min((g.current/g.target)*100, 100); return (<Card key={g.id}><div className="flex justify-between mb-2"><h3 className="font-bold text-lg dark:text-white">{g.name}</h3><span className="text-xs font-bold bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded">{p.toFixed(0)}%</span></div><p className="text-2xl font-black mb-4 dark:text-white"><PrivacyMask value={formatCurrency(g.current)} privacyMode={privacy}/> <span className="text-xs text-slate-400 font-normal">/ <PrivacyMask value={formatCurrency(g.target)} privacyMode={privacy}/></span></p><div className="w-full bg-slate-100 dark:bg-slate-700 h-3 rounded-full mb-4"><div className="bg-brand-500 h-3 rounded-full" style={{width:`${p}%`}}></div></div><Button className="w-full text-sm py-2" variant="secondary" onClick={() => openModal('depositGoal', g)}>Depositar</Button></Card>)})}</div></div>);
export const BudgetsView = ({ transactions, budgets, categories, onSaveBudget, privacy, openModal }) => { const cm = new Date().toISOString().slice(0, 7); const spending = {}; transactions.filter(t => t.type === 'expense' && t.date.startsWith(cm)).forEach(t => { spending[t.category] = (spending[t.category] || 0) + parseFloat(t.amount); }); return (<div className="animate-fade-in pb-24"><h2 className="text-2xl font-black mb-8 flex gap-2 text-slate-800 dark:text-white"><Icon name="pie" className="text-brand-500"/> Or칞amentos</h2><div className="grid grid-cols-1 md:grid-cols-2 gap-6">{categories.map(c => { const b = budgets.find(x=>x.category===c.name); const s = spending[c.name]||0; const l = b?parseFloat(b.limit):0; const p = l>0?Math.min((s/l)*100,100):0; return (<Card key={c.id}><div className="flex justify-between mb-2"><h3 className="font-bold dark:text-white">{c.name}</h3><button onClick={() => openModal('editBudget', { category: c.name, limit: l })} className="text-xs text-brand-500 font-bold">Definir</button></div>{l>0?(<><div className="flex justify-between text-xs mb-1 text-slate-400"><span>{p.toFixed(0)}%</span><span><PrivacyMask value={formatCurrency(l)} privacyMode={privacy}/></span></div><div className="w-full bg-slate-100 dark:bg-slate-700 h-2 rounded-full"><div className={`h-2 rounded-full ${p>90?'bg-rose-500':'bg-brand-500'}`} style={{width:`${p}%`}}></div></div></>):<p className="text-xs text-slate-400">Sem limite</p>}</Card>)})}</div></div>); };
export const RecurringView = ({ recurring, onAdd, onPay, privacy, openModal }) => (<div className="animate-fade-in pb-24"><div className="flex justify-between mb-8"><h2 className="text-2xl font-black flex gap-2 text-slate-800 dark:text-white"><Icon name="list" className="text-brand-500"/> Contas Fixas</h2><Button onClick={() => openModal('newRecurring')} icon="plus">Nova</Button></div><div className="grid grid-cols-1 md:grid-cols-2 gap-6">{recurring.map(r => { const p = r.lastPaid === new Date().toISOString().slice(0, 7); return (<Card key={r.id} className={`flex justify-between items-center ${p?'opacity-50':''}`}><div className="flex gap-4 items-center"><div className="bg-slate-100 dark:bg-slate-700 p-3 rounded-xl text-center min-w-[3.5rem]"><span className="text-xs font-bold text-slate-400 block">DIA</span><span className="text-xl font-black dark:text-white">{r.day}</span></div><div><h3 className="font-bold text-lg dark:text-white">{r.name}</h3><p className="font-bold text-brand-600"><PrivacyMask value={formatCurrency(parseFloat(r.amount))} privacyMode={privacy}/></p></div></div><Button onClick={()=>!p && onPay(r)} disabled={p} variant={p?'secondary':'primary'} className="text-sm py-2 px-4">{p?'Pago':'Pagar'}</Button></Card>)})}</div></div>);
export const AssetsView = ({ assets, onDelete, privacy, openModal }) => { const ta = assets.filter(a => a.type === 'asset').reduce((acc, a) => acc + parseFloat(a.value), 0); const tl = assets.filter(a => a.type === 'liability').reduce((acc, a) => acc + parseFloat(a.value), 0); return (<div className="animate-fade-in pb-24"><div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"><Card className="bg-gradient-to-br from-slate-800 to-slate-900 text-white border-none"><p className="text-slate-400 font-bold text-xs uppercase tracking-wider">Patrim칪nio L칤quido</p><p className="text-3xl font-black mt-1"><PrivacyMask value={formatCurrency(ta - tl)} privacyMode={privacy}/></p></Card><Card className="bg-white dark:bg-slate-800"><p className="text-emerald-600 font-bold text-xs uppercase tracking-wider">Ativos</p><p className="text-2xl font-bold mt-1 text-slate-800 dark:text-white"><PrivacyMask value={formatCurrency(ta)} privacyMode={privacy}/></p></Card><Card className="bg-white dark:bg-slate-800"><p className="text-rose-600 font-bold text-xs uppercase tracking-wider">Passivos</p><p className="text-2xl font-bold mt-1 text-slate-800 dark:text-white"><PrivacyMask value={formatCurrency(tl)} privacyMode={privacy}/></p></Card></div><div className="flex justify-between items-center mb-6"><h2 className="text-xl font-black flex items-center gap-2 text-slate-800 dark:text-white"><Icon name="diamond" className="text-brand-600"/> Bens & D칤vidas</h2><Button onClick={() => openModal('newAsset')} icon="plus" className="text-sm px-4 py-2">Novo</Button></div><div className="grid grid-cols-1 md:grid-cols-2 gap-6"><div className="space-y-3"><h3 className="font-bold text-slate-500 uppercase text-xs">Ativos</h3>{assets.filter(a => a.type === 'asset').map(a => (<Card key={a.id} className="flex justify-between items-center !p-4"><span className="font-bold text-slate-700 dark:text-white">{a.name}</span><div className="flex items-center gap-3"><span className="font-bold text-emerald-600"><PrivacyMask value={formatCurrency(parseFloat(a.value))} privacyMode={privacy}/></span><button onClick={()=>onDelete(a.id)} className="text-slate-300 hover:text-rose-500"><Icon name="trash" size={14}/></button></div></Card>))}</div><div className="space-y-3"><h3 className="font-bold text-slate-500 uppercase text-xs">Passivos</h3>{assets.filter(a => a.type === 'liability').map(a => (<Card key={a.id} className="flex justify-between items-center !p-4 border-l-4 border-rose-500"><span className="font-bold text-slate-700 dark:text-white">{a.name}</span><div className="flex items-center gap-3"><span className="font-bold text-rose-600"><PrivacyMask value={formatCurrency(parseFloat(a.value))} privacyMode={privacy}/></span><button onClick={()=>onDelete(a.id)} className="text-slate-300 hover:text-rose-500"><Icon name="trash" size={14}/></button></div></Card>))}</div></div></div>); };
export const CardsView = ({ cards, transactions, onDeleteCard, privacy, openModal }) => { return (<div className="animate-fade-in pb-24"><div className="flex justify-between items-center mb-8"><h2 className="text-2xl font-black flex items-center gap-2 text-slate-800 dark:text-white"><Icon name="card" className="text-brand-600"/> Cart칫es</h2><Button onClick={() => openModal('newCard')} icon="plus">Novo Cart칚o</Button></div><div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">{cards.map(card => { const today = new Date(); const cm = today.toISOString().slice(0, 7); const spent = transactions.filter(t => t.cardId === card.id && t.date.startsWith(cm)).reduce((a,b) => a + parseFloat(b.amount), 0); const avail = card.limit - spent; const p = Math.min((spent / card.limit) * 100, 100); return (<Card key={card.id} className="relative overflow-hidden bg-gradient-to-br from-slate-800 to-slate-900 text-white border-none h-56 flex flex-col justify-between"><div className="flex justify-between items-start"><div><h3 className="font-bold text-xl">{card.name}</h3><p className="text-xs text-slate-400">Fecha dia {card.closingDay}</p></div><Icon name="card" className="text-slate-600" size={32}/></div><div><p className="text-xs font-bold text-slate-400 uppercase">Fatura</p><p className="text-3xl font-black mb-2"><PrivacyMask value={formatCurrency(spent)} privacyMode={privacy}/></p><div className="w-full bg-slate-700 h-2 rounded-full mb-2"><div className={`h-2 rounded-full transition-all ${p > 80 ? 'bg-rose-500' : 'bg-emerald-500'}`} style={{width: `${p}%`}}></div></div><div className="flex justify-between text-xs font-bold text-slate-400"><span>Disp: <PrivacyMask value={formatCurrency(avail)} privacyMode={privacy}/></span><span>Lim: <PrivacyMask value={formatCurrency(parseFloat(card.limit))} privacyMode={privacy}/></span></div></div><button onClick={()=>confirm('Excluir?') && onDeleteCard(card.id)} className="absolute top-4 right-4 text-slate-600 hover:text-rose-500"><Icon name="trash" size={16}/></button></Card>); })}</div></div>); };
export const MentalView = ({ logs, openModal }) => (<div className="grid lg:grid-cols-2 gap-8 animate-fade-in pb-24"><div><h2 className="text-xl font-black mb-6 text-slate-800 dark:text-white">Check-in</h2><Card><div className="grid gap-4">{[{l:'Leve',s:10,c:'bg-emerald-100',e:'游땗'},{l:'M칠dio',s:50,c:'bg-amber-100',e:'游땛'},{l:'Alto',s:90,c:'bg-rose-100',e:'游땲'}].map(o=><button key={o.s} onClick={() => openModal('mentalCheckin', o)} className="p-4 rounded-xl border flex gap-4 items-center hover:bg-slate-50"><span className={`p-2 rounded-lg ${o.c} text-2xl`}>{o.e}</span><span className="font-bold text-slate-700 dark:text-white">{o.l}</span></button>)}</div></Card></div><div><h2 className="text-xl font-black mb-6 text-slate-800 dark:text-white">Di치rio</h2><div className="space-y-4">{logs.slice().reverse().map(l=><Card key={l.id} className="flex gap-4 items-center border-l-4 border-brand-500"><span className="text-2xl">{l.score>60?'游땲':l.score>30?'游땛':'游땗'}</span><div><h3 className="font-bold text-slate-800 dark:text-white">{l.trigger}</h3><p className="text-xs">{new Date(l.date).toLocaleString()}</p></div></Card>)}</div></div></div>);
export const CalendarView = ({ transactions, recurring }) => { const [viewDate, setViewDate] = useState(new Date()); const daysInMonth = new Date(viewDate.getFullYear(), viewDate.getMonth() + 1, 0).getDate(); const firstDay = new Date(viewDate.getFullYear(), viewDate.getMonth(), 1).getDay(); const getDayEvents = (day) => { const dateStr = new Date(viewDate.getFullYear(), viewDate.getMonth(), day).toISOString().slice(0,10); return { txs: transactions.filter(t => t.date === dateStr), recs: recurring.filter(r => r.day === day) }; }; return (<div className="animate-fade-in pb-24"><div className="flex justify-between items-center mb-6"><h2 className="text-2xl font-black flex items-center gap-2 text-slate-800 dark:text-white"><Icon name="calendar" className="text-brand-600"/> Calend치rio</h2><div className="flex gap-2"><Button variant="secondary" className="!px-3" onClick={()=>setViewDate(new Date(viewDate.setMonth(viewDate.getMonth()-1)))}><Icon name="left"/></Button><span className="px-4 py-2 bg-white dark:bg-slate-800 rounded-xl font-bold w-40 text-center flex items-center justify-center">{viewDate.toLocaleString('pt-BR', {month:'long', year:'numeric'})}</span><Button variant="secondary" className="!px-3" onClick={()=>setViewDate(new Date(viewDate.setMonth(viewDate.getMonth()+1)))}><Icon name="right"/></Button></div></div><div className="grid grid-cols-7 gap-2 mb-2 text-center font-bold text-slate-400 text-sm"><div>Dom</div><div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>Sab</div></div><div className="grid grid-cols-7 gap-2">{[...Array(firstDay)].map((_,i) => <div key={`empty-${i}`} className="h-24 md:h-32 rounded-2xl bg-transparent"></div>)}{[...Array(daysInMonth)].map((_,i) => { const day = i + 1; const { txs, recs } = getDayEvents(day); const balance = txs.reduce((acc, t) => acc + (t.type==='income'?1:-1)*parseFloat(t.amount), 0); return (<div key={day} className="h-24 md:h-32 bg-white dark:bg-slate-800 rounded-2xl p-2 border border-slate-100 dark:border-slate-700 relative hover:border-brand-500 transition-colors overflow-hidden group"><span className="font-bold text-slate-500 text-sm">{day}</span>{recs.length > 0 && <div className="absolute top-2 right-2 w-2 h-2 bg-indigo-500 rounded-full"></div>}<div className="mt-2 space-y-1">{balance !== 0 && <p className={`text-xs font-bold ${balance>0?'text-emerald-500':'text-rose-500'}`}>{balance>0?'+':''}{Math.round(balance)}</p>}{recs.map(r => <p key={r.id} className="text-[10px] text-slate-400 truncate bg-slate-100 dark:bg-slate-700 px-1 rounded">{r.name}</p>)}</div></div>); })}</div></div>); };
export const DebtsView = ({ transactions, privacy }) => { const debts = useMemo(() => { const groups = {}; transactions.filter(t => t.isInstallment).forEach(t => { if(!groups[t.installmentGroup]) groups[t.installmentGroup] = { ...t, paid: 0, total: 0, countPaid: 0 }; const g = groups[t.installmentGroup]; g.total += parseFloat(t.amount); if(new Date(t.date) < new Date()) { g.paid += parseFloat(t.amount); g.countPaid++; } }); return Object.values(groups); }, [transactions]); return (<div className="animate-fade-in pb-24"><h2 className="text-xl font-black mb-6 flex gap-2 text-slate-800 dark:text-white"><Icon name="credit"/> Parcelamentos</h2><div className="grid grid-cols-1 md:grid-cols-2 gap-6">{debts.map(d => { const p = (d.countPaid/d.installmentTotal)*100; return (<Card key={d.installmentGroup}><div className="flex justify-between mb-4"><div><h3 className="font-bold text-lg text-slate-800 dark:text-white">{d.note||d.category}</h3></div><div className="text-right"><p className="text-2xl font-black text-slate-700 dark:text-white"><PrivacyMask value={formatCurrency(d.total-d.paid)} privacyMode={privacy}/></p><p className="text-xs font-bold">RESTANTE</p></div></div><div className="w-full bg-slate-100 rounded-full h-3 mb-2"><div className="bg-brand-500 h-3 rounded-full" style={{width:`${p}%`}}></div></div><div className="flex justify-between text-xs font-bold text-slate-400"><span>{d.countPaid}/{d.installmentTotal}</span><span>{p.toFixed(0)}%</span></div></Card>)})}</div></div>); };
export const ImporterView = ({ onImport }) => { const [csvText, setCsvText] = useState(''); const processCSV = () => { const results = Papa.parse(csvText, { header: true, skipEmptyLines: true }); if (results.data.length > 0) { const txs = results.data.map(row => ({ date: row.Data || new Date().toISOString().slice(0,10), category: 'Importado', note: row.Descricao || 'CSV', amount: Math.abs(parseFloat(row.Valor || 0)), type: parseFloat(row.Valor) < 0 ? 'expense' : 'income', paymentMethod: 'Importado', installments: 1 })); onImport(txs); setCsvText(''); } else { alert('CSV Inv치lido.'); } }; return (<div className="animate-fade-in pb-24"><h2 className="text-2xl font-black mb-8 flex items-center gap-2 text-slate-800 dark:text-white"><Icon name="download" className="text-brand-600"/> Importa칞칚o</h2><Card><p className="text-slate-500 mb-4 text-sm">Cole o CSV (Colunas: Data, Descricao, Valor).</p><textarea className="w-full h-48 p-4 rounded-xl bg-slate-50 dark:bg-slate-900 border-none focus:ring-2 focus:ring-brand-500 font-mono text-xs mb-4 dark:text-white" placeholder="Data,Descricao,Valor&#10;2023-10-01,Mercado,-50.00" value={csvText} onChange={e=>setCsvText(e.target.value)}></textarea><Button onClick={processCSV} className="w-full">Processar</Button></Card></div>); };
export const ReportsView = ({ transactions }) => { const pdf = () => { const d = new window.jspdf.jsPDF(); d.text("Relat칩rio", 14, 20); d.autoTable({ head: [['Data','Cat','Tipo','Valor']], body: transactions.map(t=>[new Date(t.date).toLocaleDateString(), t.category, t.type, formatCurrency(parseFloat(t.amount))]), startY: 30 }); d.save('relatorio.pdf'); }; return (<div className="animate-fade-in space-y-6"><h2 className="text-xl font-black mb-6 text-slate-800 dark:text-white">Relat칩rios</h2><div className="grid grid-cols-2 gap-6"><Card onClick={pdf} className="text-center cursor-pointer"><Icon name="file" size={32} className="mx-auto mb-2 text-rose-500"/><h3 className="font-bold text-slate-800 dark:text-white">PDF</h3></Card></div></div>); };
export const InvestmentsView = ({ investments, onDelete, privacy, openModal }) => { const totalInvested = investments.reduce((acc, i) => acc + (i.quantity * i.currentPrice), 0); const totalCost = investments.reduce((acc, i) => acc + (i.quantity * i.buyPrice), 0); const profit = totalInvested - totalCost; const profitPercent = totalCost > 0 ? (profit / totalCost) * 100 : 0; return (<div className="animate-fade-in pb-24"><div className="flex justify-between items-center mb-8"><h2 className="text-2xl font-black flex items-center gap-2 text-slate-800 dark:text-white"><Icon name="trending" className="text-brand-600"/> Investimentos</h2><Button onClick={() => openModal('newInvestment')} icon="plus">Novo Ativo</Button></div><div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"><StatCard title="Patrim칪nio Investido" value={formatCurrency(totalInvested)} type="balance" privacy={privacy} /><Card className="bg-white dark:bg-slate-800 relative overflow-hidden"><div className="relative z-10"><p className="text-sm font-semibold text-slate-500">Lucro/Preju칤zo</p><p className={`text-3xl font-black ${profit >= 0 ? 'text-emerald-500' : 'text-rose-500'}`}><PrivacyMask value={formatCurrency(profit)} privacyMode={privacy}/></p><p className={`text-xs font-bold ${profit >= 0 ? 'text-emerald-600' : 'text-rose-600'}`}>{profit >= 0 ? '+' : ''}{profitPercent.toFixed(2)}%</p></div></Card></div><div className="grid grid-cols-1 lg:grid-cols-2 gap-6">{investments.map(i => { const currentVal = i.quantity * i.currentPrice; const gain = currentVal - (i.quantity * i.buyPrice); const gainP = (gain / (i.quantity * i.buyPrice)) * 100; return (<Card key={i.id} className="flex justify-between items-center"><div><div className="flex items-center gap-2"><span className="bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded text-xs font-bold uppercase text-slate-500">{i.type}</span><h3 className="font-bold text-lg text-slate-800 dark:text-white">{i.name}</h3></div><p className="text-xs text-slate-400">{i.quantity} cotas @ {formatCurrency(i.buyPrice)}</p></div><div className="text-right"><p className="font-bold text-lg text-slate-800 dark:text-white"><PrivacyMask value={formatCurrency(currentVal)} privacyMode={privacy}/></p><p className={`text-xs font-bold ${gain >= 0 ? 'text-emerald-500' : 'text-rose-500'}`}>{gain >= 0 ? '+' : ''}{gainP.toFixed(1)}%</p></div><button onClick={() => confirm('Remover investimento?') && onDelete(i.id)} className="ml-4 text-slate-300 hover:text-rose-500"><Icon name="trash" size={16}/></button></Card>); })}</div></div>); };
export const WishlistView = ({ wishlist, onDelete, openModal }) => { return (<div className="animate-fade-in pb-24"><div className="flex justify-between items-center mb-8"><h2 className="text-2xl font-black flex items-center gap-2 text-slate-800 dark:text-white"><Icon name="gift" className="text-brand-600"/> Lista de Desejos</h2><Button onClick={() => openModal('newWish')} icon="plus">Novo Desejo</Button></div><div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">{wishlist.map(w => (<Card key={w.id} className="relative"><div className="flex justify-between items-start mb-2"><h3 className="font-bold text-lg text-slate-800 dark:text-white">{w.name}</h3><span className={`text-[10px] px-2 py-1 rounded font-bold uppercase ${w.priority === 'Alta' ? 'bg-rose-100 text-rose-600' : w.priority === 'M칠dia' ? 'bg-amber-100 text-amber-600' : 'bg-emerald-100 text-emerald-600'}`}>{w.priority}</span></div><p className="text-2xl font-black text-slate-700 dark:text-white mb-4">{formatCurrency(parseFloat(w.price))}</p><div className="flex gap-2"><Button className="flex-1 py-2 text-sm" variant="success" onClick={() => openModal('buyWish', w)}>Comprar</Button><button onClick={() => confirm('Remover?') && onDelete(w.id)} className="p-2 text-slate-300 hover:text-rose-500"><Icon name="trash" size={18}/></button></div></Card>))}</div></div>); };
export const ToolsView = () => { 
    const [calc, setCalc] = useState({ initial: 1000, monthly: 500, rate: 10, years: 20, result: 0 }); 
    const [clt, setClt] = useState({ bruto: 3000, dependentes: 0, liquido: 0, inss: 0, irrf: 0 });
    const [infl, setInfl] = useState({ amount: 1000, years: 10, rate: 5, futureVal: 0 });
    
    const calculateCompound = () => { let total = calc.initial; const monthlyRate = calc.rate / 100 / 12; for(let i=0; i<calc.years*12; i++) total = (total + calc.monthly) * (1 + monthlyRate); setCalc({...calc, result: total}); }; 
    const calcInflation = () => { const val = infl.amount / Math.pow((1 + infl.rate/100), infl.years); setInfl({...infl, futureVal: val}); };
    const calculateCLT = () => { let base = clt.bruto; let inss = 0; if (base <= 1412.00) inss = base * 0.075; else if (base <= 2666.68) inss = (1412 * 0.075) + ((base - 1412) * 0.09); else if (base <= 4000.03) inss = (1412 * 0.075) + ((2666.68 - 1412) * 0.09) + ((base - 2666.68) * 0.12); else inss = (1412 * 0.075) + ((2666.68 - 1412) * 0.09) + ((4000.03 - 2666.68) * 0.12) + ((Math.min(base, 7786.02) - 4000.03) * 0.14); let baseIR = base - inss - (clt.dependentes * 189.59); let irrf = 0; if (baseIR > 2259.20 && baseIR <= 2826.65) irrf = (baseIR * 0.075) - 169.44; else if (baseIR <= 3751.05) irrf = (baseIR * 0.15) - 381.44; else if (baseIR <= 4664.68) irrf = (baseIR * 0.225) - 662.77; else if (baseIR > 4664.68) irrf = (baseIR * 0.275) - 896.00; if (irrf < 0) irrf = 0; setClt({ ...clt, inss, irrf, liquido: base - inss - irrf }); };

    return (<div className="animate-fade-in pb-24"><h2 className="text-2xl font-black mb-8 flex items-center gap-2 text-slate-800 dark:text-white"><Icon name="tool" className="text-brand-600"/> Ferramentas Avan칞adas</h2>
    <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <Card><h3 className="font-bold text-xl mb-6 text-slate-800 dark:text-white flex gap-2"><Icon name="calculator" className="text-emerald-500"/> Sal치rio L칤quido (CLT)</h3><div className="space-y-4"><Input label="Sal치rio Bruto" type="number" value={clt.bruto} onChange={e=>setClt({...clt, bruto: parseFloat(e.target.value)})}/><Input label="Dependentes" type="number" value={clt.dependentes} onChange={e=>setClt({...clt, dependentes: parseFloat(e.target.value)})}/><Button onClick={calculateCLT} className="w-full" variant="success">Calcular</Button><div className="p-4 bg-slate-50 dark:bg-slate-900 rounded-xl text-center space-y-2"><div className="flex justify-between text-sm text-slate-500"><span>INSS:</span> <span className="text-rose-500">-{formatCurrency(clt.inss)}</span></div><div className="flex justify-between text-sm text-slate-500"><span>IRRF:</span> <span className="text-rose-500">-{formatCurrency(clt.irrf)}</span></div><div className="pt-2 border-t border-slate-200 dark:border-slate-700"><p className="text-xs font-bold text-slate-400 uppercase">L칤quido Estimado</p><p className="text-3xl font-black text-emerald-500">{formatCurrency(clt.liquido)}</p></div></div></div></Card>
        <Card><h3 className="font-bold text-xl mb-6 text-slate-800 dark:text-white flex gap-2"><Icon name="trending" className="text-rose-500"/> Infla칞칚o (Poder de Compra)</h3><div className="space-y-4"><Input label="Valor Hoje" type="number" value={infl.amount} onChange={e=>setInfl({...infl, amount: parseFloat(e.target.value)})}/><div className="grid grid-cols-2 gap-4"><Input label="Infla칞칚o Anual %" type="number" value={infl.rate} onChange={e=>setInfl({...infl, rate: parseFloat(e.target.value)})}/><Input label="Anos" type="number" value={infl.years} onChange={e=>setInfl({...infl, years: parseFloat(e.target.value)})}/></div><Button onClick={calcInflation} className="w-full" variant="danger">Calcular</Button><div className="p-4 bg-slate-50 dark:bg-slate-900 rounded-xl text-center"><p className="text-xs font-bold text-slate-400 uppercase">Valer치 no Futuro</p><p className="text-3xl font-black text-rose-500">{formatCurrency(infl.futureVal)}</p><p className="text-xs text-slate-400 mt-1">Perda de {((1 - infl.futureVal/infl.amount)*100).toFixed(1)}% do valor</p></div></div></Card>
        <Card><h3 className="font-bold text-xl mb-6 text-slate-800 dark:text-white flex gap-2"><Icon name="snow" className="text-cyan-500"/> Bola de Neve (D칤vidas)</h3><p className="text-slate-500 text-sm mb-4">Simule quitar suas d칤vidas mais r치pido pagando um valor extra.</p><div className="p-4 bg-slate-50 dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-700 text-center"><p className="text-sm text-slate-400">Em desenvolvimento...</p></div></Card>
        <Card><h3 className="font-bold text-xl mb-6 text-slate-800 dark:text-white">Juros Compostos</h3><div className="space-y-4"><Input label="Inicial" type="number" value={calc.initial} onChange={e=>setCalc({...calc, initial: parseFloat(e.target.value)})}/><Input label="Mensal" type="number" value={calc.monthly} onChange={e=>setCalc({...calc, monthly: parseFloat(e.target.value)})}/><div className="grid grid-cols-2 gap-4"><Input label="Taxa Anual %" type="number" value={calc.rate} onChange={e=>setCalc({...calc, rate: parseFloat(e.target.value)})}/><Input label="Anos" type="number" value={calc.years} onChange={e=>setCalc({...calc, years: parseFloat(e.target.value)})}/></div><Button onClick={calculateCompound} className="w-full">Calcular</Button>{calc.result > 0 && <div className="mt-6 p-4 bg-emerald-50 dark:bg-emerald-900/30 rounded-2xl text-center"><p className="text-sm text-emerald-600/80 font-bold uppercase">Total</p><p className="text-3xl font-black text-emerald-600 dark:text-emerald-400">{formatCurrency(calc.result)}</p></div>}</div></Card>
    </div></div>);
};